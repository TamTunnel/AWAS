{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://awas.dev/schema/v1.1/manifest.json",
  "title": "AWAS Manifest v1.1",
  "description": "AI Web Action Standard manifest schema with enhanced discovery, typing, and safety contracts",
  "type": "object",
  "required": [
    "specVersion",
    "version",
    "actions"
  ],
  "properties": {
    "$schema": {
      "type": "string",
      "format": "uri",
      "description": "JSON Schema reference"
    },
    "specVersion": {
      "type": "string",
      "pattern": "^\\d+\\.\\d+$",
      "description": "AWAS specification version (e.g., '1.1')",
      "examples": ["1.0", "1.1"]
    },
    "version": {
      "type": "string",
      "pattern": "^\\d+\\.\\d+$",
      "description": "Manifest version for this specific site"
    },
    "lastUpdated": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 timestamp of last manifest update"
    },
    "name": {
      "type": "string",
      "description": "Human-readable name of the service/site"
    },
    "description": {
      "type": "string",
      "description": "Brief description of the service"
    },
    "conformanceLevel": {
      "type": "string",
      "enum": ["L1", "L2", "L3"],
      "description": "Conformance level: L1 (read-only), L2 (write with preview), L3 (full transactional)"
    },
    "actions": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/action"
      }
    },
    "workflows": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/workflow"
      }
    },
    "rate_limits": {
      "$ref": "#/definitions/rateLimits"
    },
    "authentication": {
      "$ref": "#/definitions/authentication"
    },
    "security": {
      "$ref": "#/definitions/security"
    }
  },
  "definitions": {
    "action": {
      "type": "object",
      "required": [
        "id",
        "type",
        "name",
        "method",
        "endpoint"
      ],
      "properties": {
        "id": {
          "type": "string",
          "pattern": "^[a-z_][a-z0-9_]*$",
          "description": "Stable action identifier"
        },
        "type": {
          "type": "string",
          "enum": [
            "form_submission",
            "navigation",
            "search",
            "filter",
            "data_retrieval",
            "state_change",
            "custom"
          ]
        },
        "intent": {
          "type": "string",
          "enum": ["read", "write", "delete", "execute"],
          "description": "Primary intent of the action"
        },
        "sideEffect": {
          "type": "string",
          "enum": ["safe", "idempotent", "destructive"],
          "description": "Side-effect level: safe (no state change), idempotent (repeatable), destructive (permanent changes)",
          "default": "safe"
        },
        "name": {
          "type": "string",
          "description": "Human-readable action name"
        },
        "description": {
          "type": "string",
          "description": "Detailed description of what the action does"
        },
        "method": {
          "type": "string",
          "enum": [
            "GET",
            "POST",
            "PUT",
            "DELETE",
            "PATCH"
          ]
        },
        "endpoint": {
          "type": "string",
          "description": "API endpoint or URL pattern"
        },
        "selector": {
          "type": "string",
          "description": "CSS selector for UI element (optional)"
        },
        "authentication_required": {
          "type": "boolean",
          "description": "Whether authentication is required"
        },
        "authScopes": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Required OAuth/permission scopes"
        },
        "idempotencyKeySupported": {
          "type": "boolean",
          "description": "Whether action supports idempotency keys",
          "default": false
        },
        "idempotencyKeyHeader": {
          "type": "string",
          "description": "Header name for idempotency key (e.g., 'Idempotency-Key')"
        },
        "preconditions": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "List of conditions that must be met before action can be executed"
        },
        "rateLimitHint": {
          "$ref": "#/definitions/rateLimitHint"
        },
        "inputs": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/input"
          }
        },
        "inputSchema": {
          "type": "object",
          "description": "JSON Schema for request body/parameters"
        },
        "outputs": {
          "$ref": "#/definitions/output"
        },
        "outputSchema": {
          "type": "object",
          "description": "JSON Schema for response body"
        },
        "openapi": {
          "type": "object",
            "description": "Optional OpenAPI interoperability - links this AWAS action to an OpenAPI operation for enhanced tooling support and documentation",          "properties": {
            "$ref": {
              "type": "string",
              "description": "OpenAPI operation reference (e.g., '/openapi.json#/paths/~1search/get')"
            },
              "documentUrl": {
                "type": "string",
                "description": "URL to the OpenAPI document (JSON or YAML), absolute or site-relative (e.g., '/openapi.json')"
              },
              "operationId": {
                "type": "string",
                "description": "The operationId from the OpenAPI document that this AWAS action corresponds to"
              }
          }
        },
        "previewUrl": {
          "type": "string",
          "description": "URL for preview/dry-run endpoint"
        },
        "dryRunSupported": {
          "type": "boolean",
          "description": "Whether action supports dry-run mode",
          "default": false
        },
        "conformanceLevel": {
          "type": "string",
          "enum": ["L1", "L2", "L3"],
          "description": "Minimum conformance level required for this action"
        }
      }
    },
    "input": {
      "type": "object",
      "required": [
        "name",
        "type"
      ],
      "properties": {
        "name": {
          "type": "string"
        },
        "type": {
          "type": "string",
          "enum": [
            "string",
            "integer",
            "number",
            "boolean",
            "array",
            "object"
          ]
        },
        "required": {
          "type": "boolean"
        },
        "default": {},
        "selector": {
          "type": "string"
        },
        "description": {
          "type": "string"
        },
        "examples": {
          "type": "array",
          "description": "Example values for this input"
        },
        "validation": {
          "$ref": "#/definitions/validation"
        }
      }
    },
    "validation": {
      "type": "object",
      "properties": {
        "pattern": {
          "type": "string"
        },
        "min": {
          "type": "number"
        },
        "max": {
          "type": "number"
        },
        "minLength": {
          "type": "integer"
        },
        "maxLength": {
          "type": "integer"
        },
        "enum": {
          "type": "array"
        }
      }
    },
    "output": {
      "type": "object",
      "properties": {
        "type": {
          "type": "string"
        },
        "schema": {
          "type": "object"
        },
        "examples": {
          "type": "array",
          "description": "Example response payloads"
        },
        "success_codes": {
          "type": "array",
          "items": {
            "type": "integer"
          }
        },
        "error_codes": {
          "type": "object"
        }
      }
    },
    "workflow": {
      "type": "object",
      "required": [
        "id",
        "name",
        "steps"
      ],
      "properties": {
        "id": {
          "type": "string"
        },
        "name": {
          "type": "string"
        },
        "description": {
          "type": "string"
        },
        "steps": {
          "type": "array",
          "items": {
            "type": "string"
          }
        }
      }
    },
    "rateLimits": {
      "type": "object",
      "properties": {
        "requests_per_minute": {
          "type": "integer"
        },
        "requests_per_hour": {
          "type": "integer"
        },
        "burst_limit": {
          "type": "integer"
        },
        "concurrent_requests": {
          "type": "integer"
        }
      }
    },
    "rateLimitHint": {
      "type": "object",
      "properties": {
        "requests": {
          "type": "integer",
          "description": "Number of allowed requests"
        },
        "window": {
          "type": "string",
          "description": "Time window (e.g., '1m', '1h', '1d')"
        }
      }
    },
    "authentication": {
      "type": "object",
      "properties": {
        "required": {
          "type": "boolean"
        },
        "optional_for": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "methods": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": [
              "session",
              "api_key",
              "oauth",
              "jwt",
              "bearer"
            ]
          }
        },
        "endpoints": {
          "type": "object"
        }
      }
    },
    "security": {
      "type": "object",
      "description": "Security requirements and CSRF protection details",
      "properties": {
        "csrfRequired": {
          "type": "boolean",
          "description": "Whether CSRF tokens are required"
        },
        "csrfTokenHeader": {
          "type": "string",
          "description": "Header name for CSRF token (e.g., 'X-CSRF-Token')"
        },
        "requiredHeaders": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "List of required HTTP headers"
        },
        "allowedOrigins": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "List of allowed CORS origins"
        },
        "sameSite": {
          "type": "string",
          "enum": ["Strict", "Lax", "None"],
          "description": "SameSite cookie policy"
        }
      }
    }
  }
}
